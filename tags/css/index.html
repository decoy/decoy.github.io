<!DOCTYPE HTML>
<html>
    <head>
    <meta charset="utf-8">
    <title>kellen.piffner.com</title>
    <link rel="alternative" href="/atom.xml" title="kellen.piffner.com" type="application/atom+xml">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/normalize.css" type="text/css">
    <link rel="stylesheet" href="/css/layout.css" type="text/css">
    <link rel="stylesheet" href="/css/blog.css" type="text/css">
    <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <link rel="stylesheet" href="/css/ie8.css" type="text/css">
    <![endif]-->

</head>

<body>
    <header id="header">
    <!--[if lt IE 9]>
<div class="unsupported-browser">
    <p>This site talks about a lot of modern web technologies. As such, you're going to be missing out on a lot with this older browser.</p>
    <p>I recommend upgrading to the latest <a href="https://ie.microsoft.com/">Internet Explorer</a>, <a href="https://chrome.google.com">Google Chrome</a>, or <a href="https://mozilla.org/firefox/">Firefox</a>.</p>
    <p>If you are using IE 9 or later, make sure you <a href="http://windows.microsoft.com/en-US/windows7/webpages-look-incorrect-in-Internet-Explorer">turn off "Compatibility View"</a>.</p>
</div>
<![endif]-->

<h1><a class="brand" href="/">kellen.piffner.com</a></h1>
<div class="share-icons">
    <a class="symbol" title="twitter" target="_blank" href="https://twitter.com/@KellenPiffner">&#xe086;</a>
    <a class="symbol" title="github" target="_blank" href="https://github.com/decoy">&#xe037;</a>
    <a class="symbol" title="google plus" target="_blank" href="https://plus.google.com/109745187704465695599/about">&#xe039;</a>
    <a class="symbol" title="linkedin" target="_blank" href="http://www.linkedin.com/in/kellenpiffner">&#xe052;</a>
    <a class="symbol" title="blog feed" target="_blank" href="/atom.xml">&#xe071;</a>
</div>
<!--<div class="tagcloud" id="fbox-tagcloud"><a href="/tags/blog/" style="font-size: 12.00px;">blog</a><a href="/tags/css/" style="font-size: 18.00px;">css</a><a href="/tags/hello world/" style="font-size: 12.00px;">hello world</a><a href="/tags/hexo/" style="font-size: 12.00px;">hexo</a><a href="/tags/html/" style="font-size: 12.00px;">html</a><a href="/tags/javascript/" style="font-size: 24.00px;">javascript</a><a href="/tags/microsoft/" style="font-size: 12.00px;">microsoft</a><a href="/tags/nodejs/" style="font-size: 12.00px;">nodejs</a><a href="/tags/typescript/" style="font-size: 12.00px;">typescript</a><a href="/tags/visual studio/" style="font-size: 12.00px;">visual studio</a><a href="/tags/web/" style="font-size: 18.00px;">web</a></div>-->



    </header>

    
    <article class="ghost post">
    <div class="article-date">
        <p class="article-day">31</p>
        <p class="article-month">Jan 2014</p>
    </div>
   
    <header>
        
        
<h1 class="article-title"><a href="/2014/01/31/basic-animation/">Basic Animation</a></h1>

       
    </header>
   
    <div class="article-entry">
        
        <p>In my day job, I spend a lot of time coding core business logic applications.  What do you do with data A in situation B kind of logic.  So when I work on something code related in my off time, I like to putz with technologies outside of that bubble.</p>
<p>With that in mind, I&#39;m going to talk about animation.</p>
<h2 id="old-school">Old School</h2>
<p>Back in &quot;the day&quot;, many games just updated as fast as the CPU could.  If you loaded the same game on a faster computer, the animations would move faster.  This could result in fun times likes a typing game where the game&#39;s &quot;40 words per minute&quot; was closer to 120. (I regularly scored 14!)</p>
<p>You can end up with this same problem by being &#39;frame rate dependent&#39; with your animations.  Basically, this means that you update the position of your objects at the same time that you draw the object.</p>
<p>Here&#39;s an example running 10fps, 30fps, and 60fps while drawing a simple animation:</p>
<p><p data-height="175" data-theme-id="4105" data-slug-hash="LHgbm" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/decoyahoy/pen/LHgbm'>frame based animation</a> by kp (<a href='http://codepen.io/decoyahoy'>@decoyahoy</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//codepen.io/assets/embed/ei.js"></script>

<p>The ball object handles the &#39;bounce&#39; effect.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">Ball</span><span class="params">(w, h)</span> {</span>

  <span class="comment">//let's just set this to 10 for now</span>
  <span class="keyword">this</span>.size = <span class="number">10</span>;

  <span class="comment">//initial ball positions</span>
  <span class="keyword">this</span>.x = <span class="number">0</span>;
  <span class="keyword">this</span>.y = <span class="number">0</span>;

  <span class="comment">//this is the expected change per direction per update</span>
  <span class="keyword">this</span>.dx = <span class="number">0.3</span>;
  <span class="keyword">this</span>.dy = <span class="number">2.75</span>;

  <span class="comment">//bounding box (can't escape)</span>
  <span class="keyword">this</span>.w = w;
  <span class="keyword">this</span>.h = h;
};

Ball.prototype.update = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="comment">//update the ball position</span>
  <span class="keyword">this</span>.x += <span class="keyword">this</span>.dx;
  <span class="keyword">this</span>.y += <span class="keyword">this</span>.dy;

  <span class="comment">//check to see if the ball is still in bounds</span>
  <span class="comment">//if it's not, change its direction to the opposite</span>
  <span class="keyword">if</span> (<span class="keyword">this</span>.x &lt;= <span class="number">0</span> || <span class="keyword">this</span>.x &gt;= <span class="keyword">this</span>.w - <span class="keyword">this</span>.size)
    <span class="keyword">this</span>.dx = -<span class="keyword">this</span>.dx;

  <span class="keyword">if</span> (<span class="keyword">this</span>.y &lt;= <span class="number">0</span> || <span class="keyword">this</span>.y &gt;= <span class="keyword">this</span>.h - <span class="keyword">this</span>.size)
    <span class="keyword">this</span>.dy = -<span class="keyword">this</span>.dy; 
};

Ball.prototype.draw = <span class="function"><span class="keyword">function</span><span class="params">(ctx)</span> {</span>
  <span class="comment">//let's draw the ball (box) </span>
  ctx.fillRect(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y, <span class="number">10</span>, <span class="number">10</span>);
};
</pre></td></tr></table></figure>

<p>In our main draw loop you can see us updating both the ball position, and then telling it to draw.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre>BallCanvas.prototype.animate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  
  <span class="comment">//clear the canvas between frames</span>
  <span class="keyword">this</span>.ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);

  <span class="comment">//update the ball position</span>
  <span class="keyword">this</span>.ball.update();

  <span class="comment">//now draw the ball</span>
  <span class="keyword">this</span>.ball.draw(<span class="keyword">this</span>.ctx);

  <span class="comment">//restart the loop after we're done updating</span>
  <span class="keyword">this</span>.start();
};

BallCanvas.prototype.start = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  <span class="comment">//we're forcing very specific framerates here</span>
  <span class="comment">//there are better ways...</span>
  <span class="keyword">var</span> that = <span class="keyword">this</span>;
  window.setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> that.animate() }, <span class="keyword">this</span>.frameRate);
};
</pre></td></tr></table></figure>

<h2 id="better-ways">Better ways</h2>
<p>So what other options are there?  Well, you could calculate the distance the ball travels per frame by using math.  (Yay, math!)  </p>
<p>Let&#39;s assume we want the ball to update position every 10ms (100fps from the previous example).  Instead of simply updating the ball +1 on each frame, we now get the time, compare it to the previous time, and figure out how many times the ball should have moved since the last time we updated.</p>
<p>This is the new animate function:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="code"><pre>BallCanvas.prototype.animate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

  <span class="comment">//get the current time</span>
  <span class="keyword">var</span> nextUpdate =  <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();

  <span class="comment">//how much time has passed (cummulative)</span>
  <span class="keyword">this</span>.elapsed += nextUpdate - <span class="keyword">this</span>.lastUpdate;

  <span class="comment">//how many updates do we need to process?</span>
  <span class="comment">//this is a little more complex than need be</span>
  <span class="comment">//so the example can keep the balls in sync</span>
  <span class="keyword">while</span> (<span class="keyword">this</span>.elapsed &gt; UPDATE_RATE) {
    <span class="comment">//update the ball position</span>
    <span class="keyword">this</span>.ball.update();
    <span class="comment">//keep track of the extra</span>
    <span class="keyword">this</span>.elapsed -= UPDATE_RATE;
  }

  <span class="comment">//clear the canvas between frames</span>
  <span class="keyword">this</span>.ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);

  <span class="comment">//now draw the ball</span>
  <span class="keyword">this</span>.ball.draw(<span class="keyword">this</span>.ctx);
  
  <span class="comment">//update the update time</span>
  <span class="keyword">this</span>.lastUpdate = nextUpdate;

  <span class="comment">//restart the loop after we're done updating</span>
  <span class="keyword">this</span>.start();
};
</pre></td></tr></table></figure>

<p>And this is it running:</p>
<p><p data-height="175" data-theme-id="4105" data-slug-hash="gImtA" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/decoyahoy/pen/gImtA'>frame based animation</a> by kp (<a href='http://codepen.io/decoyahoy'>@decoyahoy</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//codepen.io/assets/embed/ei.js"></script>

<p>Now, the side of me that spends all day separating business logic from infrastructure code keeps asking why I&#39;m calculating positions inside of a draw loop.  Separation of concerns is a big deal in large software projects. This brings me to the next option: have a loop just for updating.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>BallCanvas.prototype.animate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

  <span class="comment">//clear the canvas between frames</span>
  <span class="keyword">this</span>.ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);

  <span class="comment">//now draw the ball</span>
  <span class="keyword">this</span>.ball.draw(<span class="keyword">this</span>.ctx);

  <span class="comment">//restart the loop after we're done updating</span>
  <span class="keyword">this</span>.start();
};
</pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="comment">//handle the object updates separate from drawing</span>
<span class="function"><span class="keyword">function</span> <span class="title">updateBalls</span><span class="params">()</span> {</span>
  ball10.ball.update();
  ball30.ball.update();
  ball60.ball.update();
  setTimeout(updateBalls, UPDATE_RATE);
}
</pre></td></tr></table></figure>

<p><p data-height="175" data-theme-id="4105" data-slug-hash="BfCnq" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/decoyahoy/pen/BfCnq'>update loop separate from draw loops</a> by kp (<a href='http://codepen.io/decoyahoy'>@decoyahoy</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//codepen.io/assets/embed/ei.js"></script>

<p>The same results, but note the math is gone, and the code is overall simpler.  This also leads to a more useful scenario of handling user input in a way where we don&#39;t have to care what&#39;s happening with the draw loop.  How about we watch the mouse cursor?</p>
<p><p data-height="175" data-theme-id="4105" data-slug-hash="daIus" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/decoyahoy/pen/daIus'>follow the mouse</a> by kp (<a href='http://codepen.io/decoyahoy'>@decoyahoy</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//codepen.io/assets/embed/ei.js"></script>

<p>Neat!  All we did was replace our update loop from the previous example with this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">onMouseMove</span><span class="params">(e)</span> {</span>

  <span class="comment">//get the new positions</span>
  <span class="keyword">var</span> x = e.clientX;
  <span class="keyword">var</span> y = e.clientY;

  ball10.ball.x = x;
  ball10.ball.y = y;
  ball30.ball.x = x;
  ball30.ball.y = y;
  ball60.ball.x = x;
  ball60.ball.y = y;
}

<span class="comment">//watch the mouse event</span>
document.onmousemove = onMouseMove;
</pre></td></tr></table></figure>

<h2 id="cautions">Cautions</h2>
<p>In these examples, I&#39;m using setTimeout to simulate my framerates.  Don&#39;t do this.  <code>requestAnimationFrame</code> is where it&#39;s at.</p>
<p>An excellent article on the subject:
<a href="http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/" target="_blank">http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/</a></p>
<p>Also, there are a lot of very good javascript animations libraries out there.  They have excellent framerate handling that can properly use the above requestAnimationFrame, throttle framerates on slow computers, or speed them up on fast ones.  Don&#39;t reinvent the wheel if you don&#39;t need to!</p>

        
    </div>
   
    <footer>
        <div class="article-tags">
            
Tags:
  
<a href='/tags/javascript/' class="article-tag">javascript</a>
  
<a href='/tags/web/' class="article-tag">web</a>
  
<a href='/tags/css/' class="article-tag">css</a>
  

        </div>
        
    </footer>
</article>



    <article class="ghost post">
    <div class="article-date">
        <p class="article-day">17</p>
        <p class="article-month">Jan 2014</p>
    </div>
   
    <header>
        
        
<h1 class="article-title"><a href="/2014/01/17/new-blog/">New Blog</a></h1>

       
    </header>
   
    <div class="article-entry">
        
        <p>Hello and welcome to the requisite &quot;New Blog&quot; post.  This is the first blog I&#39;ve set up in awhile, and the technologies used may be interesting to some.</p>
<h2 id="static-site">Static Site</h2>
<p>To keep hosting simple, this blog is entirely static html, CSS, and JavaScript.  The &quot;server&quot; is just any web server that can spit out static files.  This choice opened up options like hosting using <a href="http://pages.github.com/" target="_blank">GitHub Pages</a>, or even <a href="https://www.dropbox.com/" target="_blank">DropBox</a>. </p>
<p>While the site is static, I&#39;m not manually copying and pasting the header and footer to all the individual pages, or even writing in html.  I&#39;m using a &quot;static site generator&quot;.  The generator works a lot like a server would: it takes my original blog entry data and my site templates and glues it all together outputting html.  The difference between it and something like PHP, is it&#39;s only doing it <em>once</em>.</p>
<p>Now there are a surprising number of &quot;static site generators&quot; out there, so I didn&#39;t have to re-invent the wheel.  This blog is currently generated using <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> - &quot;A fast, simple &amp; powerful blog framework, powered by Node.js.&quot;  </p>
<h2 id="hexo">Hexo</h2>
<p>Hexo is built using <a href="http://nodejs.org/" target="_blank">Node.js</a>, a cross platform scripting engine that&#39;s ridiculously easy to deploy and has a rapidly expanding community.  </p>
<p>Hexo itself is fairly simple.  It takes <a href="http://daringfireball.net/projects/markdown/" target="_blank">Markdown</a> files - a simple plain text format - and outputs html using <a href="http://embeddedjs.com/" target="_blank">EJS</a> templates.  Because nodejs community has lots library options for converting markdown to html and parsing EJS templates, Hexo only has to manage the flow of the process, and doesn&#39;t have to deal with the complicated parsing problems.  It&#39;s fairly simple to create custom plugins that support things other than markdown and EJS as well.</p>
<p>Because of of this simplicity, if Hexo is ever abandoned (not uncommon for an open source app), it won&#39;t be too difficult to find or create a replacement.</p>
<h2 id="source-code">Source Code</h2>
<p>If you&#39;re interested in the site, feel free to check out the source code hosted up on github.</p>
<p><a href="https://github.com/decoy/blog" target="_blank">Source</a></p>

        
    </div>
   
    <footer>
        <div class="article-tags">
            
Tags:
  
<a href='/tags/hello world/' class="article-tag">hello world</a>
  
<a href='/tags/blog/' class="article-tag">blog</a>
  
<a href='/tags/hexo/' class="article-tag">hexo</a>
  
<a href='/tags/nodejs/' class="article-tag">nodejs</a>
  
<a href='/tags/javascript/' class="article-tag">javascript</a>
  
<a href='/tags/css/' class="article-tag">css</a>
  
<a href='/tags/html/' class="article-tag">html</a>
  

        </div>
        
    </footer>
</article>




<div class="pagination">
    
    
</div>





    
    <footer id="footer">
    <div class="share-icons">
    <a class="symbol" title="twitter" target="_blank" href="https://twitter.com/@KellenPiffner">&#xe086;</a>
    <a class="symbol" title="github" target="_blank" href="https://github.com/decoy">&#xe037;</a>
    <a class="symbol" title="google plus" target="_blank" href="https://plus.google.com/109745187704465695599/about">&#xe039;</a>
    <a class="symbol" title="linkedin" target="_blank" href="http://www.linkedin.com/in/kellenpiffner">&#xe052;</a>
    <a class="symbol" title="blog feed" target="_blank" href="/atom.xml">&#xe071;</a>
</div>
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="/js/ghost.js"></script>

<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-47279370-1', 'piffner.com');
    ga('send', 'pageview');

</script>



  
<script type="text/javascript">
    //the tag 'cloud'
    var tags = [{"name":"hello world","path":"tags/hello world/","permalink":"http://kellen.piffner.com/tags/hello world/","slug":"hello world","length":1},{"name":"blog","path":"tags/blog/","permalink":"http://kellen.piffner.com/tags/blog/","slug":"blog","length":1},{"name":"hexo","path":"tags/hexo/","permalink":"http://kellen.piffner.com/tags/hexo/","slug":"hexo","length":1},{"name":"nodejs","path":"tags/nodejs/","permalink":"http://kellen.piffner.com/tags/nodejs/","slug":"nodejs","length":1},{"name":"javascript","path":"tags/javascript/","permalink":"http://kellen.piffner.com/tags/javascript/","slug":"javascript","length":3},{"name":"css","path":"tags/css/","permalink":"http://kellen.piffner.com/tags/css/","slug":"css","length":2},{"name":"html","path":"tags/html/","permalink":"http://kellen.piffner.com/tags/html/","slug":"html","length":1},{"name":"typescript","path":"tags/typescript/","permalink":"http://kellen.piffner.com/tags/typescript/","slug":"typescript","length":1},{"name":"microsoft","path":"tags/microsoft/","permalink":"http://kellen.piffner.com/tags/microsoft/","slug":"microsoft","length":1},{"name":"visual studio","path":"tags/visual studio/","permalink":"http://kellen.piffner.com/tags/visual studio/","slug":"visual studio","length":1},{"name":"web","path":"tags/web/","permalink":"http://kellen.piffner.com/tags/web/","slug":"web","length":2}];
</script>





</body>
</html>
