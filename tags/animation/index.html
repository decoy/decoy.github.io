<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8" />
    <meta name="author" content="Kellen Piffner" />
    
    <meta name="description" content="Developer blogging about web technology, healthcare, and whatever else comes to mind." />
    <title>kellen.piffner.com</title>
    
    <link rel="alternative" href="/atom.xml" title="kellen.piffner.com" type="application/atom+xml">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/normalize.css" type="text/css">
    <link rel="stylesheet" href="/css/layout.css" type="text/css">
    <link rel="stylesheet" href="/css/blog.css" type="text/css">
    <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <link rel="stylesheet" href="/css/ie8.css" type="text/css">
    <![endif]-->
    
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-47279370-1', 'piffner.com');
    ga('send', 'pageview');

</script>

    
</head>

<body>
    <header id="header">
    <!--[if lt IE 9]>
<div class="unsupported-browser">
    <p>This site talks about a lot of modern web technologies. As such, you're going to be missing out on a lot with this older browser.</p>
    <p>I recommend upgrading to the latest <a href="https://ie.microsoft.com/">Internet Explorer</a>, <a href="https://chrome.google.com">Google Chrome</a>, or <a href="https://mozilla.org/firefox/">Firefox</a>.</p>
    <p>If you are using IE 9 or later, make sure you <a href="http://windows.microsoft.com/en-US/windows7/webpages-look-incorrect-in-Internet-Explorer">turn off "Compatibility View"</a>.</p>
</div>
<![endif]-->

<h1><a class="brand" href="/">kellen.piffner.com</a></h1>
<div class="share-icons">
    <a class="social-symbol" title="twitter" target="_blank" href="https://twitter.com/@KellenPiffner">&#xe086;</a>
    <a class="social-symbol" title="github" target="_blank" href="https://github.com/decoy">&#xe037;</a>
    <a class="social-symbol" title="google plus" target="_blank" href="https://plus.google.com/109745187704465695599/about">&#xe039;</a>
    <a class="social-symbol" title="linkedin" target="_blank" href="http://www.linkedin.com/in/kellenpiffner">&#xe052;</a>
    <a class="social-symbol" title="blog feed" target="_blank" href="/atom.xml">&#xe071;</a>
</div>
    </header>

    
    <article class="ghost post">
    <div class="article-date">
        <p class="article-day">31</p>
        <p class="article-month">Jan 2014</p>
    </div>

    <header>

        
<h1 class="article-title"><a href="/2014/01/31/basic-animation/">Basic Animation</a></h1>


    </header>

    <div class="article-entry">
        
        <p>In my day job, I spend a lot of time coding core business logic applications.  What do you do with data A in situation B kind of logic.  So when I work on something code related in my off time, I like to putz with technologies outside of that bubble.</p>
<p>With that in mind, I&#39;m going to talk about animation.</p>
<h2 id="old-school">Old School</h2>
<p>Back in &quot;the day&quot;, many games just updated as fast as the CPU could.  If you loaded the same game on a faster computer, everything would move faster.  This could result in fun times likes a typing game where the game&#39;s &quot;40 words per minute&quot; was closer to 120. (I regularly scored 14!)</p>
<p>You can end up with this same problem by being &#39;frame rate dependent&#39; with your animations.  Basically, this means that you update the position of your objects at the same time that you draw the object.</p>
<p>Here&#39;s an example running 10fps, 30fps, and 60fps while drawing a simple animation:</p>
<p><p data-height="175" data-theme-id="4105" data-slug-hash="LHgbm" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/decoyahoy/pen/LHgbm'>frame based animation</a> by kp (<a href='http://codepen.io/decoyahoy'>@decoyahoy</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//codepen.io/assets/embed/ei.js"></script>

<p>The ball object handles the &#39;bounce&#39; effect.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">Ball</span><span class="params">(w, h)</span> {</span>

  <span class="comment">//let's just set this to 10 for now</span>
  <span class="keyword">this</span>.size = <span class="number">10</span>;

  <span class="comment">//initial ball positions</span>
  <span class="keyword">this</span>.x = <span class="number">0</span>;
  <span class="keyword">this</span>.y = <span class="number">0</span>;

  <span class="comment">//this is the expected change per direction per update</span>
  <span class="keyword">this</span>.dx = <span class="number">0.3</span>;
  <span class="keyword">this</span>.dy = <span class="number">2.75</span>;

  <span class="comment">//bounding box (can't escape)</span>
  <span class="keyword">this</span>.w = w;
  <span class="keyword">this</span>.h = h;
};

Ball.prototype.update = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="comment">//update the ball position</span>
  <span class="keyword">this</span>.x += <span class="keyword">this</span>.dx;
  <span class="keyword">this</span>.y += <span class="keyword">this</span>.dy;

  <span class="comment">//check to see if the ball is still in bounds</span>
  <span class="comment">//if it's not, change its direction to the opposite</span>
  <span class="keyword">if</span> (<span class="keyword">this</span>.x &lt;= <span class="number">0</span> || <span class="keyword">this</span>.x &gt;= <span class="keyword">this</span>.w - <span class="keyword">this</span>.size)
    <span class="keyword">this</span>.dx = -<span class="keyword">this</span>.dx;

  <span class="keyword">if</span> (<span class="keyword">this</span>.y &lt;= <span class="number">0</span> || <span class="keyword">this</span>.y &gt;= <span class="keyword">this</span>.h - <span class="keyword">this</span>.size)
    <span class="keyword">this</span>.dy = -<span class="keyword">this</span>.dy; 
};

Ball.prototype.draw = <span class="function"><span class="keyword">function</span><span class="params">(ctx)</span> {</span>
  <span class="comment">//let's draw the ball (box) </span>
  ctx.fillRect(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y, <span class="number">10</span>, <span class="number">10</span>);
};
</pre></td></tr></table></figure>

<p>In our main draw loop you can see us updating both the ball position, and then telling it to draw.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre>BallCanvas.prototype.animate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  
  <span class="comment">//clear the canvas between frames</span>
  <span class="keyword">this</span>.ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);

  <span class="comment">//update the ball position</span>
  <span class="keyword">this</span>.ball.update();

  <span class="comment">//now draw the ball</span>
  <span class="keyword">this</span>.ball.draw(<span class="keyword">this</span>.ctx);

  <span class="comment">//restart the loop after we're done updating</span>
  <span class="keyword">this</span>.start();
};

BallCanvas.prototype.start = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  <span class="comment">//we're forcing very specific framerates here</span>
  <span class="comment">//there are better ways...</span>
  <span class="keyword">var</span> that = <span class="keyword">this</span>;
  window.setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> that.animate() }, <span class="keyword">this</span>.frameRate);
};
</pre></td></tr></table></figure>

<h2 id="better-ways">Better ways</h2>
<p>So what other options are there?  Well, you could calculate the distance the ball travels per frame by using math.  (Yay, math!)  </p>
<p>Let&#39;s assume we want the ball to update position every 10ms (100fps from the previous example).  Instead of simply updating the ball +1 on each frame, we now get the time, compare it to the previous time, and figure out how many times the ball should have moved since the last time we updated.</p>
<p>This is the new animate function:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="code"><pre>BallCanvas.prototype.animate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

  <span class="comment">//get the current time</span>
  <span class="keyword">var</span> nextUpdate =  <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();

  <span class="comment">//how much time has passed (cummulative)</span>
  <span class="keyword">this</span>.elapsed += nextUpdate - <span class="keyword">this</span>.lastUpdate;

  <span class="comment">//how many updates do we need to process?</span>
  <span class="comment">//this is a little more complex than need be</span>
  <span class="comment">//so the example can keep the balls in sync</span>
  <span class="keyword">while</span> (<span class="keyword">this</span>.elapsed &gt; UPDATE_RATE) {
    <span class="comment">//update the ball position</span>
    <span class="keyword">this</span>.ball.update();
    <span class="comment">//keep track of the extra</span>
    <span class="keyword">this</span>.elapsed -= UPDATE_RATE;
  }

  <span class="comment">//clear the canvas between frames</span>
  <span class="keyword">this</span>.ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);

  <span class="comment">//now draw the ball</span>
  <span class="keyword">this</span>.ball.draw(<span class="keyword">this</span>.ctx);
  
  <span class="comment">//update the update time</span>
  <span class="keyword">this</span>.lastUpdate = nextUpdate;

  <span class="comment">//restart the loop after we're done updating</span>
  <span class="keyword">this</span>.start();
};
</pre></td></tr></table></figure>

<p>And this is it running:</p>
<p><p data-height="175" data-theme-id="4105" data-slug-hash="gImtA" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/decoyahoy/pen/gImtA'>frame based animation</a> by kp (<a href='http://codepen.io/decoyahoy'>@decoyahoy</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//codepen.io/assets/embed/ei.js"></script>

<p>Now, the side of me that spends all day separating business logic from infrastructure code keeps asking why I&#39;m calculating positions inside of a draw loop.  Separation of concerns is a big deal in large software projects. This brings me to the next option: have a loop just for updating.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>BallCanvas.prototype.animate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

  <span class="comment">//clear the canvas between frames</span>
  <span class="keyword">this</span>.ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);

  <span class="comment">//now draw the ball</span>
  <span class="keyword">this</span>.ball.draw(<span class="keyword">this</span>.ctx);

  <span class="comment">//restart the loop after we're done updating</span>
  <span class="keyword">this</span>.start();
};
</pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="comment">//handle the object updates separate from drawing</span>
<span class="function"><span class="keyword">function</span> <span class="title">updateBalls</span><span class="params">()</span> {</span>
  ball10.ball.update();
  ball30.ball.update();
  ball60.ball.update();
  setTimeout(updateBalls, UPDATE_RATE);
}
</pre></td></tr></table></figure>

<p><p data-height="175" data-theme-id="4105" data-slug-hash="BfCnq" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/decoyahoy/pen/BfCnq'>update loop separate from draw loops</a> by kp (<a href='http://codepen.io/decoyahoy'>@decoyahoy</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//codepen.io/assets/embed/ei.js"></script>

<p>The same results, but note the math is gone, and the code is overall simpler.  This also leads to a more useful scenario of handling user input in a way where we don&#39;t have to care what&#39;s happening with the draw loop.  How about we watch the mouse cursor?</p>
<p><p data-height="175" data-theme-id="4105" data-slug-hash="daIus" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/decoyahoy/pen/daIus'>follow the mouse</a> by kp (<a href='http://codepen.io/decoyahoy'>@decoyahoy</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//codepen.io/assets/embed/ei.js"></script>

<p>Neat!  All we did was replace our update loop from the previous example with this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">onMouseMove</span><span class="params">(e)</span> {</span>

  <span class="comment">//get the new positions</span>
  <span class="keyword">var</span> x = e.clientX;
  <span class="keyword">var</span> y = e.clientY;

  ball10.ball.x = x;
  ball10.ball.y = y;
  ball30.ball.x = x;
  ball30.ball.y = y;
  ball60.ball.x = x;
  ball60.ball.y = y;
}

<span class="comment">//watch the mouse event</span>
document.onmousemove = onMouseMove;
</pre></td></tr></table></figure>

<h2 id="cautions">Cautions</h2>
<p>In these examples, I&#39;m using setTimeout to simulate my framerates.  Don&#39;t do this.  <code>requestAnimationFrame</code> is where it&#39;s at.</p>
<p>An excellent article on the subject:
<a href="http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/" target="_blank">http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/</a></p>
<p>Also, there are a lot of very good javascript animations libraries out there.  They have excellent framerate handling that can properly use the above requestAnimationFrame, throttle framerates on slow computers, or speed them up on fast ones.  Don&#39;t reinvent the wheel if you don&#39;t need to!</p>

        
    </div>

    <footer>
        <div class="article-tags">
            
Tags:
  
<a href='/tags/javascript/' class="article-tag">javascript</a>
  
<a href='/tags/web/' class="article-tag">web</a>
  
<a href='/tags/codepen/' class="article-tag">codepen</a>
  
<a href='/tags/animation/' class="article-tag">animation</a>
  

        </div>
        
        
    </footer>
</article>




<div class="pagination">
    
    
</div>





    
    <footer id="footer">
    <div class="share-icons">
    <a class="social-symbol" title="twitter" target="_blank" href="https://twitter.com/@KellenPiffner">&#xe086;</a>
    <a class="social-symbol" title="github" target="_blank" href="https://github.com/decoy">&#xe037;</a>
    <a class="social-symbol" title="google plus" target="_blank" href="https://plus.google.com/109745187704465695599/about">&#xe039;</a>
    <a class="social-symbol" title="linkedin" target="_blank" href="http://www.linkedin.com/in/kellenpiffner">&#xe052;</a>
    <a class="social-symbol" title="blog feed" target="_blank" href="/atom.xml">&#xe071;</a>
</div>
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="/js/ghost.js"></script>



  
<script type="text/javascript">
    //the tag 'cloud'
    var tags = [{"name":"hello world","path":"tags/hello world/","permalink":"http://kellen.piffner.com/tags/hello world/","slug":"hello world","length":1},{"name":"blog","path":"tags/blog/","permalink":"http://kellen.piffner.com/tags/blog/","slug":"blog","length":1},{"name":"hexo","path":"tags/hexo/","permalink":"http://kellen.piffner.com/tags/hexo/","slug":"hexo","length":1},{"name":"nodejs","path":"tags/nodejs/","permalink":"http://kellen.piffner.com/tags/nodejs/","slug":"nodejs","length":1},{"name":"javascript","path":"tags/javascript/","permalink":"http://kellen.piffner.com/tags/javascript/","slug":"javascript","length":4},{"name":"css","path":"tags/css/","permalink":"http://kellen.piffner.com/tags/css/","slug":"css","length":1},{"name":"html","path":"tags/html/","permalink":"http://kellen.piffner.com/tags/html/","slug":"html","length":1},{"name":"typescript","path":"tags/typescript/","permalink":"http://kellen.piffner.com/tags/typescript/","slug":"typescript","length":1},{"name":"microsoft","path":"tags/microsoft/","permalink":"http://kellen.piffner.com/tags/microsoft/","slug":"microsoft","length":1},{"name":"visual studio","path":"tags/visual studio/","permalink":"http://kellen.piffner.com/tags/visual studio/","slug":"visual studio","length":1},{"name":"web","path":"tags/web/","permalink":"http://kellen.piffner.com/tags/web/","slug":"web","length":3},{"name":"codepen","path":"tags/codepen/","permalink":"http://kellen.piffner.com/tags/codepen/","slug":"codepen","length":2},{"name":"animation","path":"tags/animation/","permalink":"http://kellen.piffner.com/tags/animation/","slug":"animation","length":1},{"name":"css3","path":"tags/css3/","permalink":"http://kellen.piffner.com/tags/css3/","slug":"css3","length":1},{"name":"angularjs","path":"tags/angularjs/","permalink":"http://kellen.piffner.com/tags/angularjs/","slug":"angularjs","length":1},{"name":"svn","path":"tags/svn/","permalink":"http://kellen.piffner.com/tags/svn/","slug":"svn","length":1},{"name":"development","path":"tags/development/","permalink":"http://kellen.piffner.com/tags/development/","slug":"development","length":1}];
</script>





</body>
</html>
